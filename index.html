<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>èµ„æ–™ç®¡ç†ç³»ç»Ÿ - æ”¯æŒæ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤å’Œæœ¬åœ°å›¾ç‰‡ä¸Šä¼ </title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  /* å·¦ä¾§ç›®å½• */
  .sidebar {
    width: 220px;
    background: #f4f4f4;
    border-right: 1px solid #ccc;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }
  .sidebar-top {
    padding: 10px;
    border-bottom: 1px solid #ccc;
  }
  #addBtn {
    display: none;
    width: 100%;
    padding: 8px;
    background: #4a90e2;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }
  #addBtn:hover {
    background: #357abd;
  }
  .sidebar .search {
    width: 100%;
    padding: 8px;
    box-sizing: border-box;
    border: none;
    border-bottom: 1px solid #ccc;
    font-size: 14px;
  }
  .item {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #ddd;
    color: #0366d6;
    user-select: none;
    transition: background-color 0.2s, text-decoration 0.2s;
  }
  .item:hover {
    background-color: #ddd;
    text-decoration: underline;
  }
  .item.active {
    background-color: #e1ecf4;
    font-weight: bold;
  }

  /* ç›®å½•å³ä¾§æ•´ä½“å®¹å™¨ */
  .main-content {
    flex: 1;
    display: flex;
    height: 100vh;
  }

  /* å·¦ä¾§å†…å®¹åŒºåŸŸ */
  .content-text {
    flex-basis: 50%;
    padding: 20px 30px;
    box-sizing: border-box;
    overflow-y: auto;
    border-right: 1px solid #ccc;
    background: #fff;
    color: #333;
  }
  .content-text h2 {
    margin-top: 0;
    border-bottom: 1px solid #ddd;
    padding-bottom: 0.3em;
  }
  .content-text p {
    line-height: 1.6;
    white-space: pre-wrap;
  }

  /* ç¼–è¾‘åŒºè¾“å…¥æ¡† */
  .content-text textarea,
  .content-text input[type="text"] {
    width: 100%;
    font-family: Consolas, Monaco, 'Courier New', monospace;
    font-size: 14px;
    padding: 10px;
    box-sizing: border-box;
    margin-top: 8px;
    margin-bottom: 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    resize: vertical;
  }
  .edit-controls {
    margin-top: 10px;
    display: flex;
    gap: 10px;
  }
  .edit-controls button {
    flex: 1;
    padding: 8px 20px;
    font-size: 14px;
    background-color: #4a90e2;
    border: none;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .edit-controls button:hover {
    background-color: #357abd;
  }
  .edit-controls button.delete {
    background-color: #d9534f;
  }
  .edit-controls button.delete:hover {
    background-color: #c9302c;
  }

  /* å³ä¾§å›¾ç‰‡åŒºåŸŸ */
  .content-image {
    flex-basis: 50%;
    padding: 20px;
    box-sizing: border-box;
    background: #fafafa;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }
  .content-image img {
    max-width: 100%;
    max-height: 70vh;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    margin-bottom: 10px;
  }

  /* ç™»å½•æ¡†ï¼Œå³ä¸Šè§’ */
  #loginBox {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #fffae6;
    padding: 10px 15px;
    border-radius: 6px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  #loginBox input[type="password"] {
    padding: 6px 8px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  #loginBox button {
    padding: 6px 14px;
    font-size: 14px;
    background-color: #28a745;
    border: none;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #loginBox button:hover {
    background-color: #218838;
  }

  /* æ–°å¢å¼¹çª—é®ç½©å’Œå†…å®¹ */
  #addModal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.3);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1100;
  }
  #addModal .modal-content {
    background: white;
    padding: 20px 25px;
    border-radius: 8px;
    width: 400px;
    max-width: 90vw;
    box-sizing: border-box;
  }
  #addModal label {
    display: block;
    margin-top: 12px;
    font-weight: 600;
  }
  #addModal input[type="text"],
  #addModal textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 8px;
    margin-top: 6px;
    font-size: 14px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-family: Consolas, Monaco, 'Courier New', monospace;
    resize: vertical;
  }
  #addModal input[type="file"] {
    margin-top: 6px;
  }
  #addModal button {
    margin-top: 15px;
    padding: 10px 20px;
    background: #4a90e2;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 15px;
  }
  #addModal button:hover {
    background: #357abd;
  }
  #addModal .btn-cancel {
    background: #aaa;
    margin-left: 10px;
  }
  #addModal .btn-cancel:hover {
    background: #888;
  }
</style>
</head>
<body>

<!-- å·¦ä¾§ç›®å½• -->
<div class="sidebar">
  <div class="sidebar-top">
    <button id="addBtn">â• æ·»åŠ èµ„æ–™</button>
  </div>
  <input id="searchBox" class="search" placeholder="æœç´¢èµ„æ–™..." />
  <div id="itemList"></div>
</div>

<!-- å³ä¾§æ ‡é¢˜+å†…å®¹ å’Œ å›¾ç‰‡ -->
<div class="main-content">
  <div class="content-text" id="contentText">
    <h2>æ¬¢è¿</h2>
    <p>è¯·ä»å·¦ä¾§ç›®å½•é€‰æ‹©ä¸€é¡¹æŸ¥çœ‹è¯¦æƒ…ã€‚</p>
  </div>
  <div class="content-image">
    <img id="contentImage" src="" alt="" />
  </div>
</div>

<!-- ç™»å½•æ¡† -->
<div id="loginBox">
  <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥å¯†ç " />
  <button id="loginBtn">ç™»å½•</button>
</div>

<!-- æ·»åŠ èµ„æ–™å¼¹çª— -->
<div id="addModal">
  <div class="modal-content">
    <h3>æ·»åŠ æ–°èµ„æ–™</h3>
    <label for="newTitle">åç§°</label>
    <input type="text" id="newTitle" placeholder="è¯·è¾“å…¥åç§°" />
    <label for="newContent">å†…å®¹</label>
    <textarea id="newContent" rows="5" placeholder="è¯·è¾“å…¥å†…å®¹"></textarea>
    <label for="newImageFile">é€‰æ‹©å›¾ç‰‡</label>
    <input type="file" id="newImageFile" accept="image/*" />
    <div style="margin-top:12px; text-align:right;">
      <button id="btnAddSave">ä¿å­˜</button>
      <button class="btn-cancel" id="btnAddCancel">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<script>
  const PASSWORD = "123456";
  let loggedIn = false;
  let currentIndex = null;

  const dataKey = "myDataWithImages";

  function loadData() {
    let data = localStorage.getItem(dataKey);
    if (data) {
      return JSON.parse(data);
    } else {
      return [
        {
          title: "ç¤ºä¾‹èµ„æ–™1",
          content: "è¿™æ˜¯ç¬¬ä¸€æ¡èµ„æ–™å†…å®¹ï¼Œæ”¯æŒå¤šè¡Œæ–‡æœ¬ã€‚\nä½ å¯ä»¥æ”¾å¾ˆè¯¦ç»†çš„ä»‹ç»ã€‚",
          image: "https://picsum.photos/id/1015/600/400"
        },
        {
          title: "ç¤ºä¾‹èµ„æ–™2",
          content: "è¿™æ˜¯ç¬¬äºŒæ¡èµ„æ–™å†…å®¹ï¼Œå¯ä»¥æ¢æˆä½ è‡ªå·±çš„æ–‡æœ¬ã€‚\næ”¯æŒæ¢è¡Œå’Œæ ¼å¼ã€‚",
          image: "https://picsum.photos/id/1016/600/400"
        },
        {
          title: "ç¤ºä¾‹èµ„æ–™3",
          content: "ç¬¬ä¸‰æ¡èµ„æ–™å†…å®¹ï¼Œä¸°å¯Œæœ‰è¶£ã€‚",
          image: "https://picsum.photos/id/1018/600/400"
        }
      ];
    }
  }

  function saveData(data) {
    localStorage.setItem(dataKey, JSON.stringify(data));
  }

  const itemList = document.getElementById("itemList");
  const contentText = document.getElementById("contentText");
  const contentImage = document.getElementById("contentImage");
  const searchBox = document.getElementById("searchBox");
  const loginBox = document.getElementById("loginBox");
  const passwordInput = document.getElementById("passwordInput");
  const loginBtn = document.getElementById("loginBtn");
  const addBtn = document.getElementById("addBtn");
  const addModal = document.getElementById("addModal");
  const newTitleInput = document.getElementById("newTitle");
  const newContentInput = document.getElementById("newContent");
  const newImageFileInput = document.getElementById("newImageFile");
  const btnAddSave = document.getElementById("btnAddSave");
  const btnAddCancel = document.getElementById("btnAddCancel");

  function renderList(filter = "") {
    itemList.innerHTML = "";
    const data = loadData();
    data.forEach((item, index) => {
      if (item.title.includes(filter) || item.content.includes(filter)) {
        const div = document.createElement("div");
        div.className = "item";
        div.textContent = item.title;
        div.onclick = () => {
          selectItem(index, div);
        };
        itemList.appendChild(div);
      }
    });
  }

  function showContent(index) {
    const data = loadData();
    const item = data[index];
    contentText.innerHTML = `
      <h2>${item.title}</h2>
      <p>${item.content.replace(/\n/g, "<br>")}</p>
    `;
    contentImage.src = item.image;
    contentImage.alt = item.title;
  }

  function showEdit(index) {
    const data = loadData();
    const item = data[index];

    contentText.innerHTML = "";

    const nameInput = document.createElement("input");
    nameInput.type = "text";
    nameInput.value = item.title;
    nameInput.placeholder = "è¯·è¾“å…¥åç§°";
    contentText.appendChild(nameInput);

    const textarea = document.createElement("textarea");
    textarea.value = item.content;
    contentText.appendChild(textarea);

    const editControls = document.createElement("div");
    editControls.className = "edit-controls";

    const imgUrlInput = document.createElement("input");
    imgUrlInput.type = "text";
    imgUrlInput.value = item.image;
    imgUrlInput.placeholder = "å›¾ç‰‡ URL æˆ–ç•™ç©ºä½¿ç”¨ä¸Šä¼ å›¾ç‰‡";
    editControls.appendChild(imgUrlInput);

    const imgFileInput = document.createElement("input");
    imgFileInput.type = "file";
    imgFileInput.accept = "image/*";
    imgFileInput.style.marginTop = "8px";
    editControls.appendChild(imgFileInput);

    imgFileInput.addEventListener("change", () => {
      const file = imgFileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = e => {
          imgUrlInput.value = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    const saveBtn = document.createElement("button");
    saveBtn.textContent = "ğŸ’¾ ä¿å­˜ä¿®æ”¹";
    saveBtn.onclick = () => {
      const newTitle = nameInput.value.trim() || "æœªå‘½å";
      const newContent = textarea.value;
      const newImage = imgUrlInput.value.trim() || "https://via.placeholder.com/600x400?text=æ— å›¾";

      const data = loadData();
      data[index].title = newTitle;
      data[index].content = newContent;
      data[index].image = newImage;
      saveData(data);

      alert("ä¿®æ”¹å·²ä¿å­˜ï¼");

      renderList(searchBox.value.trim());

      const items = itemList.querySelectorAll(".item");
      for(let el of items) {
        if(el.textContent === newTitle) {
          el.classList.add("active");
          break;
        }
      }

      contentImage.src = newImage;
      contentImage.alt = newTitle;
      nameInput.value = newTitle;
    };
    editControls.appendChild(saveBtn);

    const delBtn = document.createElement("button");
    delBtn.textContent = "ğŸ—‘ åˆ é™¤";
    delBtn.className = "delete";
    delBtn.onclick = () => {
      if(confirm(`ç¡®å®šè¦åˆ é™¤â€œ${item.title}â€å—ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ï¼`)) {
        const data = loadData();
        data.splice(index,1);
        saveData(data);
        alert("å·²åˆ é™¤ï¼");
        currentIndex = null;
        renderList(searchBox.value.trim());
        contentText.innerHTML = `<h2>æ¬¢è¿</h2><p>è¯·ä»å·¦ä¾§ç›®å½•é€‰æ‹©ä¸€é¡¹æŸ¥çœ‹è¯¦æƒ…ã€‚</p>`;
        contentImage.src = "";
        contentImage.alt = "";
      }
    };
    editControls.appendChild(delBtn);

    contentText.appendChild(editControls);
  }

  function selectItem(index, element) {
    currentIndex = index;
    document.querySelectorAll(".item").forEach(el => el.classList.remove("active"));
    element.classList.add("active");

    if (loggedIn) {
      showEdit(index);
    } else {
      showContent(index);
    }
  }

  searchBox.addEventListener("input", e => {
    renderList(e.target.value.trim());
    const first = itemList.querySelector(".item");
    if (first) {
      first.click();
    } else {
      contentText.innerHTML = `<h2>æ— åŒ¹é…å†…å®¹</h2><p>è¯·å°è¯•å…¶ä»–å…³é”®è¯ã€‚</p>`;
      contentImage.src = "";
      contentImage.alt = "";
    }
  });

  loginBtn.onclick = () => {
    if (passwordInput.value === PASSWORD) {
      loggedIn = true;
      alert("ç™»å½•æˆåŠŸï¼");
      loginBox.style.display = "none";
      addBtn.style.display = "block";
      if (currentIndex !== null) {
        showEdit(currentIndex);
      }
    } else {
      alert("å¯†ç é”™è¯¯ï¼");
    }
    passwordInput.value = "";
  };

  addBtn.onclick = () => {
    newTitleInput.value = "";
    newContentInput.value = "";
    newImageFileInput.value = "";
    addModal.style.display = "flex";
  };

  btnAddCancel.onclick = () => {
    addModal.style.display = "none";
  };

  btnAddSave.onclick = () => {
    const title = newTitleInput.value.trim() || "æœªå‘½å";
    const content = newContentInput.value.trim() || "";
    const file = newImageFileInput.files[0];

    if (!content) {
      alert("å†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
      return;
    }

    function saveNewItem(imageData) {
      const data = loadData();
      data.push({
        title,
        content,
        image: imageData || "https://via.placeholder.com/600x400?text=æ— å›¾"
      });
      saveData(data);
      addModal.style.display = "none";
      renderList(searchBox.value.trim());

      const items = itemList.querySelectorAll(".item");
      let lastItem = null;
      items.forEach(el => {
        if (el.textContent === title) {
          lastItem = el;
        }
      });
      if (lastItem) {
        lastItem.click();
      }
    }

    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        saveNewItem(e.target.result);
      };
      reader.readAsDataURL(file);
    } else {
      saveNewItem(null);
    }
  };

  // é¡µé¢åˆå§‹åŒ–
  renderList();
  const firstItem = itemList.querySelector(".item");
  if (firstItem) firstItem.click();

</script>
</body>
</html>
